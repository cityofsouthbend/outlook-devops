(()=>{"use strict";var e={};function t(e,t,n,r,a,o,i){try{var c=e[o](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,a)}function n(e){return function(){var n=this,r=arguments;return new Promise((function(a,o){var i=e.apply(n,r);function c(e){t(i,a,o,c,s,"next",e)}function s(e){t(i,a,o,c,s,"throw",e)}c(void 0)}))}}function r(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var n=e.g.document;if(!t&&n&&(n.currentScript&&(t=n.currentScript.src),!t)){var r=n.getElementsByTagName("script");if(r.length)for(var a=r.length-1;a>-1&&!t;)t=r[a--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})(),e.p,e.p,e.p;var o="",i=[],c=[],s="",u=function(e){return"https://dev.azure.com/southbendin/_apis/wit/workitems/".concat(e.val,"?api-version=6.0")},l="https://dev.azure.com/southbendin/Digital%20-%20Product%20Portfolio/_apis/wit/attachments?fileName=OriginalEmail.html&api-version=6.0",p=function(e){return"https://dev.azure.com/southbendin/Digital%20-%20Product%20Portfolio/_apis/wit/attachments?fileName=".concat(e.val,"&api-version=5.1")},d="Basic "+btoa("Basic:fcajyldotexdyluqenqd6lrqdimrr6shgrbdthg6tbmv4jpyikka"),m={method:"POST",headers:{"Content-Type":"application/json;charset=utf-8",Authorization:d},body:"{\n  \"query\": \"Select [System.Id], [System.Title], [System.State] From WorkItems Where [System.WorkItemType] = 'Maintenance' AND [System.State] <> 'Archived'\"}"},f={method:"GET",headers:{"Content-Type":"application/json",Authorization:d}};function h(e){var t="";return e.workItems.forEach((function(e){t+=e.id+","})),t.slice(0,-1)}function v(e){for(var t=new Map,n='<select id="parentItem" name="parentItem">',o=0;o<e.length;o++)t.set(e[o].id,e[o].fields["System.Title"]);var i;new Map((i=t,function(e){if(Array.isArray(e))return a(e)}(i)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(i)||r(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).sort((function(e,t){return String(e[1]).localeCompare(t[1])}))).forEach((function(e,t){var r='<option value="'.concat(t,'">').concat(e," - Maintenance Item: ").concat(t,"</option>");n+=r})),n+="</select>",document.querySelector("#dropdown").innerHTML=n}function y(e){var t;return{method:"POST",headers:{"Content-Type":"application/octet-stream",Authorization:d},body:(t={val:e},"".concat(t.val))}}function g(e,t){var n;return{method:"PATCH",headers:{"Content-Type":"application/json-patch+json",Authorization:d},body:JSON.stringify((n={val:e},[{op:"add",path:"/relations/-",value:{rel:"AttachedFile",url:"".concat(n.val),attributes:{comment:"Created with Outlook Azure add-in"}}},{op:"replace",path:"/fields/System.Description",value:"".concat(t)}]))}}function b(e){var t;return{method:"PATCH",headers:{"Content-Type":"application/json-patch+json",Authorization:d},body:JSON.stringify((t={val:e},[{op:"add",path:"/fields/System.IterationPath",from:null,value:"".concat(t.val)}]))}}function w(){return(w=n(regeneratorRuntime.mark((function e(){var t,n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://dev.azure.com/southbendin/_apis/wit/wiql?api-version=6.0",m);case 2:return t=e.sent,e.next=5,t.json();case 5:return n=e.sent,r=h(n),e.next=9,fetch("https://dev.azure.com/southbendin/_apis/wit/workitems?ids=".concat(r,"&api-version=6.0"),f);case 9:return a=e.sent,e.next=12,a.json();case 12:v(e.sent.value);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e,t){return x.apply(this,arguments)}function x(){return x=n(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("data:".concat(t.ContentType,";base64, ").concat(t.ContentBytes)).then((function(e){return e.blob()})).then(function(){var e=n(regeneratorRuntime.mark((function e(a){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(p({val:t.Name}),{method:"POST",headers:{"Content-Type":"application/octet-stream",Authorization:d},body:a}).then((function(e){return e.json()})).then(function(){var e=n(regeneratorRuntime.mark((function e(n){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.replace('src="cid:'.concat(t.ContentId,'"'),'src="'.concat(n.url,'"')),o=a,e.next=4,fetch(u({val:r.id}),g(n.url,o)).then((function(e){return e.json()}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)}))),x.apply(this,arguments)}function S(){var e,t,a=function(){var e=document.getElementById("parentItem").value,t=document.getElementById("bug-ticket").checked?"Bug":"Task",n=document.getElementById("item-subject");return[t,e,""==n.value?n.placeholder:n.value,document.getElementById("users").value]}(),s=(t=4,function(e){if(Array.isArray(e))return e}(e=a)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return n}}(e,t)||r(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),p=s[0],m=s[1],f=s[2],h=s[3];fetch("https://vssps.dev.azure.com/southbendin/_apis/graph/users?api-version=6.0-preview.1",{method:"GET",headers:{Authorization:d}}).then((function(e){return e.json()})).then((function(e){for(var t=0;t<e.value.length;t++)if(e.value[t].displayName==document.getElementById("ticketCreator").value)return e.value[t]})).then((function(e){var t;console.log(o),fetch((t={val:p},"https://dev.azure.com/southbendin/Applications%20-%20Project%20Portfolio/_apis/wit/workitems/$".concat(t.val,"?bypassrules=true&api-version=6.0")),function(e,t,n,r){var a,o;return fetch("https://dev.azure.com/southbendin/Digital%20-%20Product%20Portfolio/_apis/work/teamsettings/iterations?$timeframe=current&api-version=6.0").then((function(e){return console.log(e)})),{method:"POST",headers:{"Content-Type":"application/json-patch+json",Authorization:d},body:JSON.stringify((a={val:t},o={val:e},[{op:"add",path:"/fields/System.Title",from:null,value:"".concat(a.val)},{op:"add",path:"/fields/System.CreatedBy",value:{displayName:"".concat(n.displayName),url:"".concat(n.url),_links:{avatar:{href:"".concat(n._links.avatar.href)}},id:"".concat(n.originId),uniqueName:"".concat(n.uniqueName),imageUrl:"".concat(n.imageUrl),descriptor:"".concat(n.descriptor)}},{op:"add",path:"/fields/System.ChangedBy",value:{displayName:"".concat(n.displayName),url:"".concat(n.url),_links:{avatar:{href:"".concat(n._links.avatar.href)}},id:"".concat(n.originId),uniqueName:"".concat(n.uniqueName),imageUrl:"".concat(n.imageUrl),descriptor:"".concat(n.descriptor)}},{op:"add",path:"/fields/System.AssignedTo",value:"".concat(r)},{op:"add",path:"/relations/-",value:{rel:"System.LinkTypes.Hierarchy-Reverse",url:"https://dev.azure.com/southbendin/_apis/wit/workItems/".concat(o.val),attributes:{isLocked:!1,name:"Parent"}}}]))}}(m,f,e,h)).then((function(e){return e.json()})).then(function(){var e=n(regeneratorRuntime.mark((function e(t){var n,r,a,s,p,m,f,h,v,w;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(l,y(o));case 2:return n=e.sent,e.next=5,n.json();case 5:return r=e.sent,e.next=8,fetch(u({val:t.id}),g(r.url,o));case 8:return e.sent,e.next=11,fetch("https://dev.azure.com/southbendin/Digital%20-%20Product%20Portfolio/_apis/work/teamsettings/iterations?$timeframe=current&api-version=6.0",{method:"GET",headers:{"Content-Type":"application/json",Authorization:d}});case 11:return a=e.sent,e.next=14,a.json();case 14:return s=e.sent,console.log(s),e.next=18,fetch(u({val:t.id}),b(s.value[0].path));case 18:for(p=e.sent,m=p.json(),console.log(m),f=document.querySelectorAll('input[type="checkbox"]:checked'),h=0;h<f.length;h++)for(v=0;v<c.length;v++)f[h].value==c[v].Name&&i.push(c[v]);w=0;case 24:if(!(w<i.length)){e.next=30;break}return e.next=27,k(i[w],t);case 27:w++,e.next=24;break;case 30:document.getElementById("app-body").innerHTML="<div>DevOps ticket ".concat(t.id,' has been created. View the ticket in DevOps <a href="https://dev.azure.com/southbendin/Digital%20-%20Product%20Portfolio/_workitems/edit/').concat(t.id,'" target="_blank">here</a></div>');case 31:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}))}function T(){return(T=n(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:S();case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Office.onReady((function(e){if(e.host===Office.HostType.Outlook){document.getElementById("sideload-msg").style.display="none",document.getElementById("app-body").style.display="flex";var t=document.getElementById("run");t.addEventListener("click",(function(){!function(){T.apply(this,arguments)}(),t.setAttribute("disabled",""),t.innerHTML='<i class="fa fa-spinner fa-spin"></i> Loading'})),function(){w.apply(this,arguments)}();var n=Office.context.mailbox.item;console.log(n),o+="<p>Begin display of original email</p>\n                      <hr>\n                      <p>From: ".concat(n.from.displayName," <br>\n                      Email: ").concat(n.from.emailAddress," <br>");var r=Office.context.mailbox.userProfile.displayName;d=Office.context.mailbox.item.attachments;for(var a=document.getElementById("files"),i="",u=[".png",".jpg",".gif",".jpeg",".bmp",".eps",".jpeg"],l=function(e){var t=u.some((function(t){return d[e].name.includes(t)}));i+=t?'<input type="checkbox" name="attachedFile" checked value="'.concat(d[e].name,'" style="visibility:hidden;"><br>'):'<input type="checkbox" name="attachedFile" checked value="'.concat(d[e].name,'">').concat(d[e].name,"<br>")},p=0;p<d.length;p++)l(p);i+='<hr><p class="small-tag">Inline image files are included by default</p>',a.innerHTML=i;var d=Office.context.mailbox.item.attachments;console.log(d),document.getElementById("item-subject").placeholder=n.subject,document.getElementById("ticketCreator").value=r,Office.context.mailbox.getCallbackTokenAsync({isRest:!0},(function(e){var t=Office.context.mailbox.item.itemId;s=e.value;var n=t.replaceAll("/","-").replaceAll("+","_"),r=(Office.context.mailbox.restUrl||"https://outlook.office365.com/api")+"/v2.0/me/messages/"+n,a=r+"/attachments",i=new XMLHttpRequest;i.open("GET",r),i.setRequestHeader("Prefer",'outlook.body-content-type="html"'),i.setRequestHeader("Authorization","Bearer "+s),i.onload=function(e){var t=JSON.parse(i.responseText);o+=t.Body.Content;var n=new XMLHttpRequest;n.open("GET",a),n.setRequestHeader("Authorization","Bearer "+s),n.onload=function(e){var t=JSON.parse(n.responseText);c=t.value},n.send()},i.send()}))}}))})();
//# sourceMappingURL=taskpane.js.map