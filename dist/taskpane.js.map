{"version":3,"file":"taskpane.js","mappings":"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","sources":["webpack:///webpack/bootstrap?","webpack:///webpack/runtime/define property getters?","webpack:///webpack/runtime/global?","webpack:///webpack/runtime/hasOwnProperty shorthand?","webpack:///webpack/runtime/publicPath?","webpack:///./src/taskpane/taskpane.js?"],"sourcesContent":["// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) scriptUrl = scripts[scripts.length - 1].src\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","/* eslint-disable prettier/prettier */\r\n/* eslint-disable no-undef */\r\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n * See LICENSE in the project root for license information.\r\n */\r\n\r\n// images references in the manifest\r\nimport \"../../assets/icon-16.png\";\r\nimport \"../../assets/icon-32.png\";\r\nimport \"../../assets/icon-80.png\";\r\n\r\nlet textAttachment = \"\";\r\nlet attachments = [];\r\nlet selectedAttachments = [];\r\nlet attachmentArray = [];\r\nlet token = \"\";\r\n\r\n\r\n// declaring variables (or functions that return urls) for url addresses to use in various api calls\r\nconst idURL = ($) => `https://dev.azure.com/southbendin/_apis/wit/workitems?ids=${$.val}&api-version=6.0`;\r\nconst wiqlURL = 'https://dev.azure.com/southbendin/_apis/wit/wiql?api-version=6.0';\r\nconst ticketURL = ($) =>\r\n  `https://dev.azure.com/southbendin/Applications%20-%20Project%20Portfolio/_apis/wit/workitems/$${$.val}?bypassrules=true&api-version=6.0`;\r\nconst updateAttachmentURL = ($) => `https://dev.azure.com/southbendin/_apis/wit/workitems/${$.val}?api-version=6.0`;\r\nconst createAttachmentURL = `https://dev.azure.com/southbendin/Applications%20-%20Project%20Portfolio/_apis/wit/attachments?fileName=OriginalEmail.html&api-version=6.0`;\r\nconst createAttachmentURL2 = ($) => `https://dev.azure.com/southbendin/Applications%20-%20Project%20Portfolio/_apis/wit/attachments?fileName=${$.val}&api-version=5.1`;\r\n\r\n// the token is assigned to appsadmin@southbendin.gov - we may want to rethink this in future releases with using the Microsoft Graph API\r\n// this token has an expiration date of 1/23/23\r\nconst paToken = \"Basic \" + btoa(\"Basic\" + \":\" + \"p6l4ydakwngcbswzyilmfhidth5vx57veh3djy6vxiiefap5dfaq\");\r\n\r\nconst queryWIQL = `{\r\n  \"query\": \"Select [System.Id], [System.Title], [System.State] From WorkItems Where [System.WorkItemType] = 'Maintenance' AND [System.State] <> 'Archived'\"}`;\r\n\r\nconst headersWIQL = {\r\n  method: \"POST\",\r\n  headers: { \"Content-Type\": \"application/json;charset=utf-8\", Authorization: paToken },\r\n  body: queryWIQL\r\n};\r\n\r\nconst headersMaintenance = {\r\n  method: \"GET\",\r\n  headers: { \"Content-Type\": \"application/json\", Authorization: paToken }};\r\n\r\nfunction concatIDs(data) {\r\n  let str = \"\";\r\n  data.workItems.forEach((element) => { str += element.id + \",\"  });\r\n  return str.slice(0, -1);\r\n}\r\n\r\nfunction createDropdown(data) {\r\n  const maintenanceItems = new Map();\r\n  let html = `<select id=\"parentItem\" name=\"parentItem\">`;\r\n  for (let d = 0; d < data.length; d++) {\r\n    maintenanceItems.set(data[d].id, data[d].fields[\"System.Title\"]);\r\n  }\r\n  const sortedItems = new Map([...maintenanceItems].sort((a, b) => String(a[1]).localeCompare(b[1])));\r\n  sortedItems.forEach(function (v, k) {\r\n    let htmlSegment = `<option value=\"${k}\">${v} - Maintenance Item: ${k}</option>`;\r\n    html += htmlSegment;\r\n  }); \r\n  html += `</select>`;\r\n  let container = document.querySelector(\"#dropdown\");\r\n  container.innerHTML = html;\r\n}\r\n\r\nfunction grabFormItems() {\r\n  let selectResult = document.getElementById(\"parentItem\").value;\r\n  //Get bug or task ticket\r\n  let ticketType = document.getElementById(\"bug-ticket\").checked ? \"Bug\" : \"Task\";\r\n  //get title for ticket\r\n  let ticketTitle = document.getElementById(\"item-subject\");\r\n  let ticketTitleValue = \"\";\r\n  if ( ticketTitle.value == \"\") {\r\n    ticketTitleValue = ticketTitle.placeholder;\r\n  } else {\r\n    ticketTitleValue = ticketTitle.value;\r\n  }\r\n  let ticketAssign = document.getElementById(\"users\").value;\r\n  return [ticketType, selectResult, ticketTitleValue, ticketAssign];\r\n}\r\n\r\nfunction createTicketHeader(parent, ticketTitle, creator, dev) {\r\n  fetch('https://dev.azure.com/southbendin/Applications%20-%20Project%20Portfolio/_apis/work/teamsettings/iterations?$timeframe=current&api-version=6.0')\r\n    .then( res => console.log(res));\r\n  const newBody = ($1, $2) => [\r\n    {\"op\": \"add\", \"path\": \"/fields/System.Title\", \"from\": null, \"value\": `${$1.val}` },\r\n    {\r\n      \"op\": \"add\",\r\n      \"path\": \"/fields/System.CreatedBy\",\r\n      \"value\": {\r\n        \"displayName\": `${creator.displayName}`,\r\n        \"url\": `${creator.url}`,\r\n        \"_links\": {\r\n          \"avatar\": {\r\n            \"href\": `${creator._links.avatar.href}`\r\n          }\r\n      },\r\n        \"id\": `${creator.originId}`,\r\n        \"uniqueName\": `${creator.uniqueName}`,\r\n        \"imageUrl\": `${creator.imageUrl}`,\r\n        \"descriptor\": `${creator.descriptor}`\r\n        }\r\n    },{\r\n      \"op\": \"add\",\r\n      \"path\": \"/fields/System.ChangedBy\",\r\n      \"value\": {\r\n          \"displayName\": `${creator.displayName}`,\r\n          \"url\": `${creator.url}`,\r\n          \"_links\": {\r\n            \"avatar\": {\r\n              \"href\": `${creator._links.avatar.href}`\r\n            }\r\n        },\r\n          \"id\": `${creator.originId}`,\r\n          \"uniqueName\": `${creator.uniqueName}`,\r\n          \"imageUrl\": `${creator.imageUrl}`,\r\n          \"descriptor\": `${creator.descriptor}`\r\n      }\r\n      },\r\n    {\r\n      \"op\": \"add\",\r\n      \"path\": \"/fields/System.AssignedTo\",\r\n      \"value\": `${dev}`\r\n    },\r\n    {\"op\": \"add\", \"path\": \"/relations/-\", \"value\": { \"rel\": \"System.LinkTypes.Hierarchy-Reverse\", \"url\": `https://dev.azure.com/southbendin/_apis/wit/workItems/${$2.val}`, \"attributes\": { \"isLocked\": false, \"name\": \"Parent\" }}}];\r\n    \r\n  const headersNewTicket = {method: 'POST', headers: { 'Content-Type': 'application/json-patch+json','Authorization': paToken}, body: JSON.stringify(newBody({val: ticketTitle}, {val: parent}))};\r\n  return headersNewTicket;\r\n}\r\n\r\nfunction createAttachmentHeader(emailText) {\r\n  const textBody = ($) => `${$.val}`;\r\n  const makeAttachment = {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/octet-stream\", Authorization: paToken },\r\n    body: textBody({val: emailText})\r\n  };\r\n  return makeAttachment;\r\n}\r\n\r\nfunction addAttachmentHeader(attachURL, textAttachment) {\r\n  const newBody = ($) => [\r\n    { \"op\": \"add\", \r\n      \"path\": \"/relations/-\", \r\n      \"value\": { \r\n        \"rel\": \"AttachedFile\", \"url\": `${$.val}`,\r\n        \"attributes\": {\r\n          \"comment\": \"Created with Outlook Azure add-in\"\r\n        }\r\n      }\r\n    },\r\n    {\r\n      \"op\": \"replace\",\r\n      \"path\": \"/fields/System.Description\",\r\n      \"value\": `${textAttachment}`\r\n    }\r\n  ];\r\n\r\n  const headerAddAttachment = {\r\n    method: \"PATCH\",\r\n    headers: { \"Content-Type\": \"application/json-patch+json\", Authorization: paToken },\r\n    body: JSON.stringify(newBody({val: attachURL}))\r\n  };\r\n    return headerAddAttachment;\r\n  } \r\n\r\n  function addIterationPath(path) {\r\n    const newBody = ($) => [\r\n        {\r\n          \"op\": \"add\",\r\n          \"path\": \"/fields/System.IterationPath\",\r\n          \"from\": null,\r\n          \"value\": `${$.val}`\r\n        }\r\n      ];\r\n  \r\n    const headerAddAttachment = {\r\n      method: \"PATCH\",\r\n      headers: { \"Content-Type\": \"application/json-patch+json\", Authorization: paToken },\r\n      body: JSON.stringify(newBody({val: path}))\r\n    };\r\n      return headerAddAttachment;\r\n    } \r\n\r\n\r\n\r\nasync function getMaintenanceItems() {\r\n  let responseWIQL = await fetch(wiqlURL, headersWIQL);\r\n  let dataWIQL = await responseWIQL.json();\r\n  let ids = concatIDs(dataWIQL);\r\n  let responseMaintenance = await fetch(idURL({val: ids}), headersMaintenance);\r\n  let dataMaintenance = await responseMaintenance.json();\r\n  createDropdown(dataMaintenance.value);\r\n}\r\n\r\nasync function handleAttachments(attachment, ticketInfo) {\r\n  // this works in grabing the attachment and adding it to the ticket - there doesn't seem to be size limits either\r\n    await fetch(`data:${attachment.ContentType};base64, ${attachment.ContentBytes}`)\r\n      .then( res => res.blob())\r\n      .then( async (blob) => {\r\n        await fetch(createAttachmentURL2({val: attachment.Name}), {\r\n          method: \"POST\",\r\n          headers: { \"Content-Type\": \"application/octet-stream\", Authorization: paToken },\r\n          body: blob\r\n        }).then( res =>  res.json())\r\n          .then ( async (data) => {\r\n            let temp = textAttachment.replace(`src=\"cid:${attachment.ContentId}\"`, `src=\"${data.url}\"`);\r\n            textAttachment = temp;\r\n            await fetch(updateAttachmentURL({val: ticketInfo.id}), addAttachmentHeader(data.url, textAttachment))\r\n            .then( res => res.json())\r\n          });\r\n      })\r\n} // end handleAttachments function\r\n\r\nfunction createNewTicket() {\r\n  let [ticketType, parent, ticketTitle, assignedDev] = grabFormItems();\r\n  let getCreator = fetch(\"https://vssps.dev.azure.com/southbendin/_apis/graph/users?api-version=6.0-preview.1\", {\r\n    method: \"GET\",\r\n    headers: {Authorization: paToken}\r\n    }).then( res => res.json() )\r\n      .then( (data) => {\r\n        for (let i = 0; i < data.value.length; i++) {\r\n          if (data.value[i].displayName == document.getElementById(\"ticketCreator\").value) {\r\n            return data.value[i];\r\n          }\r\n        }\r\n    });\r\n\r\n  let createTicketMethod = () => {\r\n    getCreator.then( (creator) => {\r\n      console.log(textAttachment);\r\n      fetch(ticketURL({val: ticketType}), createTicketHeader(parent, ticketTitle, creator, assignedDev))\r\n        .then( res => res.json())\r\n        .then( async (dataTicket) => {\r\n\r\n          // adding the email body as a html file (includes inline images)\r\n          let resAttach = await fetch(createAttachmentURL, createAttachmentHeader(textAttachment));\r\n          let dataAttach = await resAttach.json()\r\n          let addAttach = await fetch(updateAttachmentURL({val: dataTicket.id}), addAttachmentHeader(dataAttach.url, textAttachment));\r\n  \r\n          let currentIteration = await fetch(\"https://dev.azure.com/southbendin/Applications%20-%20Project%20Portfolio/_apis/work/teamsettings/iterations?$timeframe=current&api-version=6.0\", {\r\n            method: \"GET\",\r\n            headers: { \"Content-Type\": \"application/json\", Authorization: paToken }\r\n          });\r\n          let dataIteration = await currentIteration.json()\r\n          console.log(dataIteration)\r\n          let currentPath = await fetch(updateAttachmentURL({val: dataTicket.id}), addIterationPath(dataIteration.value[0].path));\r\n          let response = currentPath.json()\r\n          console.log(response)\r\n\r\n          // adding attachments selected by user\r\n          const tempSelected = document.querySelectorAll('input[type=\"checkbox\"]:checked');\r\n          for (let g = 0; g < tempSelected.length; g++ ) {\r\n            for ( let h = 0; h < attachmentArray.length; h++ ) {\r\n              if ( tempSelected[g].value == attachmentArray[h].Name) {\r\n                selectedAttachments.push(attachmentArray[h]);\r\n              }\r\n            }\r\n          }\r\n          \r\n          for ( let i = 0; i < selectedAttachments.length; i++ ) {\r\n            await handleAttachments(selectedAttachments[i], dataTicket);\r\n          }\r\n\r\n\r\n          // When sideloaded app has completed this message is printed to the user's sideload window\r\n          document.getElementById(\"app-body\").innerHTML = `<div>DevOps ticket ${dataTicket.id} has been created. View the ticket in DevOps <a href=\"https://dev.azure.com/southbendin/Applications%20-%20Project%20Portfolio/_workitems/edit/${dataTicket.id}\" target=\"_blank\">here</a></div>`;\r\n        })\r\n      });\r\n  }\r\n  createTicketMethod();\r\n} // end createNewTicket()\r\n\r\n// Office generated code when add-in is sideloaded\r\nOffice.onReady((info) => {\r\n  if (info.host === Office.HostType.Outlook) {\r\n    document.getElementById(\"sideload-msg\").style.display = \"none\";\r\n    document.getElementById(\"app-body\").style.display = \"flex\";\r\n    let btn = document.getElementById(\"run\");\r\n    btn.addEventListener(\"click\", () => {\r\n      run();\r\n      btn.setAttribute(\"disabled\", \"\");\r\n      btn.innerHTML = '<i class=\"fa fa-spinner fa-spin\"></i> Loading';\r\n    })\r\n    \r\n    getMaintenanceItems();\r\n    var item = Office.context.mailbox.item;\r\n    console.log(item);\r\n    textAttachment += `<p>Begin display of original email</p>\r\n                      <hr>\r\n                      <p>From: ${item.from.displayName} <br>\r\n                      Email: ${item.from.emailAddress} <br>`\r\n    var ticketCreator = Office.context.mailbox.userProfile.displayName;\r\n\r\n    // grab the info about attachments from the email \r\n    attachments = Office.context.mailbox.item.attachments;\r\n\r\n    // add the attachments to the add-in \r\n    let attachP = document.getElementById(\"files\");\r\n    let filesToInclude = \"\";\r\n    let conditions = ['.png', '.jpg', '.gif', '.jpeg', '.bmp', '.eps', '.jpeg']\r\n    for (let i = 0; i < attachments.length; i++) {\r\n      let test = conditions.some( c => attachments[i].name.includes(c));\r\n      if (!test) {\r\n        filesToInclude += `<input type=\"checkbox\" name=\"attachedFile\" checked value=\"${attachments[i].name}\">${attachments[i].name}<br>`;\r\n      } else {\r\n        filesToInclude += `<input type=\"checkbox\" name=\"attachedFile\" checked value=\"${attachments[i].name}\" style=\"visibility:hidden;\"><br>`;\r\n      }\r\n    }\r\n    filesToInclude += '<hr><p class=\"small-tag\">Inline image files are included by default</p>'\r\n    attachP.innerHTML = filesToInclude;\r\n\r\n    var attachments = Office.context.mailbox.item.attachments;\r\n    console.log(attachments);\r\n    \r\n    // Write message property value to the task pane\r\n    document.getElementById(\"item-subject\").placeholder = item.subject;\r\n    document.getElementById(\"ticketCreator\").value = ticketCreator; //This is hidden on the html form\r\n    \r\n    // This callback is to grab the inner\r\n    Office.context.mailbox.getCallbackTokenAsync({ isRest: true }, (result) => {\r\n      var ewsId = Office.context.mailbox.item.itemId;\r\n      token = result.value;\r\n  \r\n      // var restId = Office.context.mailbox.convertToRestId(ewsId, Office.MailboxEnums.RestVersion.v2_0); this does not work on API version 1.1\r\n      let restId = ewsId.replaceAll(\"/\", \"-\").replaceAll(\"+\", \"_\"); // Convert ewsId to restId\r\n      var getMessageUrl = (Office.context.mailbox.restUrl || 'https://outlook.office365.com/api') + '/v2.0/me/messages/' + restId;\r\n      var getAttachmentsUrl = getMessageUrl + '/attachments';\r\n      var xhr = new XMLHttpRequest();\r\n      xhr.open('GET', getMessageUrl);\r\n      xhr.setRequestHeader('Prefer', 'outlook.body-content-type=\"html\"') \r\n      xhr.setRequestHeader(\"Authorization\", \"Bearer \" + token);\r\n      xhr.onload = (e) => {\r\n        var json = JSON.parse(xhr.responseText);\r\n        textAttachment += json.Body.Content;\r\n        var xhr2 = new XMLHttpRequest();\r\n        xhr2.open('GET', getAttachmentsUrl);\r\n        xhr2.setRequestHeader(\"Authorization\", \"Bearer \" + token);\r\n        xhr2.onload = (e) => {\r\n          let json2 = JSON.parse(xhr2.responseText);\r\n          attachmentArray = json2.value;\r\n        \r\n        }\r\n        xhr2.send();\r\n      }\r\n      xhr.send();\r\n    });\r\n  }\r\n});\r\n\r\nexport async function run() {\r\n  createNewTicket();\r\n} \r\n"],"names":["__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","d","definition","key","o","Object","defineProperty","enumerable","get","g","globalThis","this","Function","e","window","obj","prop","prototype","hasOwnProperty","call","scriptUrl","importScripts","location","document","currentScript","src","scripts","getElementsByTagName","length","Error","replace","p","textAttachment","selectedAttachments","attachmentArray","token","idURL","$","val","wiqlURL","updateAttachmentURL","createAttachmentURL2","paToken","btoa","headersWIQL","method","headers","Authorization","body","headersMaintenance","concatIDs","data","str","workItems","forEach","element","id","slice","createDropdown","maintenanceItems","Map","html","set","fields","sort","a","b","String","localeCompare","v","k","htmlSegment","querySelector","innerHTML","createAttachmentHeader","emailText","addAttachmentHeader","attachURL","JSON","stringify","addIterationPath","path","fetch","responseWIQL","json","dataWIQL","ids","responseMaintenance","value","handleAttachments","attachment","ticketInfo","ContentType","ContentBytes","then","res","blob","Name","temp","ContentId","url","createNewTicket","selectResult","getElementById","ticketType","checked","ticketTitle","placeholder","grabFormItems","parent","assignedDev","i","displayName","creator","console","log","dev","$1","$2","_links","avatar","href","originId","uniqueName","imageUrl","descriptor","createTicketHeader","dataTicket","resAttach","dataAttach","currentIteration","dataIteration","currentPath","response","tempSelected","querySelectorAll","h","push","Office","onReady","info","host","HostType","Outlook","style","display","btn","addEventListener","run","setAttribute","getMaintenanceItems","item","context","mailbox","from","emailAddress","ticketCreator","userProfile","attachments","attachP","filesToInclude","conditions","test","some","c","name","includes","subject","getCallbackTokenAsync","isRest","result","ewsId","itemId","restId","replaceAll","getMessageUrl","restUrl","getAttachmentsUrl","xhr","XMLHttpRequest","open","setRequestHeader","onload","parse","responseText","Body","Content","xhr2","json2","send"],"sourceRoot":""}