{"version":3,"file":"taskpane.js","mappings":"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","sources":["webpack:///webpack/bootstrap?","webpack:///webpack/runtime/define property getters?","webpack:///webpack/runtime/global?","webpack:///webpack/runtime/hasOwnProperty shorthand?","webpack:///webpack/runtime/publicPath?","webpack:///./src/taskpane/taskpane.js?"],"sourcesContent":["// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) scriptUrl = scripts[scripts.length - 1].src\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","/* eslint-disable prettier/prettier */\n/* eslint-disable no-undef */\n/*\n * Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\n * See LICENSE in the project root for license information.\n */\n\n// images references in the manifest\nimport \"../../assets/icon-16.png\";\nimport \"../../assets/icon-32.png\";\nimport \"../../assets/icon-80.png\";\n\n// global variables\nlet textAttachment = \"\";\n\nconst idURL = ($) => `https://dev.azure.com/southbendin/_apis/wit/workitems?ids=${$.val}&api-version=6.0`;\nconst wiqlURL = 'https://dev.azure.com/southbendin/_apis/wit/wiql?api-version=6.0';\nconst ticketURL = ($) =>\n  `https://dev.azure.com/southbendin/Applications%20-%20Project%20Portfolio/_apis/wit/workitems/$${$.val}?api-version=6.0`;\nconst updateAttachmentURL = ($) => `https://dev.azure.com/southbendin/_apis/wit/workitems/${$.val}?api-version=6.0`;\nconst createAttachmentURL = `https://dev.azure.com/southbendin/Applications%20-%20Project%20Portfolio/_apis/wit/attachments?fileName=EmailAsFileAttachment.txt&api-version=6.0`;\n\nconst paToken = \"Basic \" + btoa(\"Basic\" + \":\" + \"iinmtwdby2a5k3v6dekdc5y53raw7vsavivuss4fm47l4bu6fwzq\");\n\nconst queryWIQL = `{\n  \"query\": \"Select [System.Id], [System.Title], [System.State] From WorkItems Where [System.WorkItemType] = 'Maintenance'\"}`;\n\nconst headersWIQL = {\n  method: \"POST\",\n  headers: { \"Content-Type\": \"application/json;charset=utf-8\", Authorization: paToken },\n  body: queryWIQL\n};\nconst headersMaintenance = {\n  method: \"GET\",\n  headers: { \"Content-Type\": \"application/json\", Authorization: paToken }};\n\nfunction concatIDs(data) {\n  let str = \"\";\n  data.workItems.forEach((element) => { str += element.id + \",\"  });\n  return str.slice(0, -1);\n}\n\nfunction createDropdown(data) {\n  const maintenanceItems = new Map();\n  let html = `<select id=\"parentItem\" name=\"parentItem\">`;\n  for (let d = 0; d < data.length; d++) {\n    maintenanceItems.set(data[d].id, data[d].fields[\"System.Title\"]);\n  }\n  const sortedItems = new Map([...maintenanceItems].sort((a, b) => String(a[1]).localeCompare(b[1])));\n  sortedItems.forEach(function (v, k) {\n    let htmlSegment = `<option value=\"${k}\">${v} - Maintenance Item: ${k}</option>`;\n    html += htmlSegment;\n  }); \n  html += `</select>`;\n  let container = document.querySelector(\"#dropdown\");\n  container.innerHTML = html;\n}\n\nfunction grabFormItems() {\n  let selectResult = document.getElementById(\"parentItem\").value;\n  //Get bug or task ticket\n  let ticketType = document.getElementById(\"bug-ticket\").checked ? \"Bug\" : \"Task\";\n  //get title for ticket\n  let ticketTitle = document.getElementById(\"item-subject\").value;\n\n  return [ticketType, selectResult, ticketTitle];\n}\n\nfunction createTicketHeader(parent, ticketTitle) {\n  const newBody = ($1, $2) => [\n    {\"op\": \"add\", \"path\": \"/fields/System.Title\", \"from\": null, \"value\": `${$1.val}` },\n    {\"op\": \"add\", \"path\": \"/relations/-\", \"value\": { \"rel\": \"System.LinkTypes.Hierarchy-Reverse\", \"url\": `https://dev.azure.com/southbendin/_apis/wit/workItems/${$2.val}`, \"attributes\": { \"isLocked\": false, \"name\": \"Parent\" }}}];\n\n  const headersNewTicket = {method: 'POST', headers: { 'Content-Type': 'application/json-patch+json','Authorization': paToken}, body: JSON.stringify(newBody({val: ticketTitle}, {val: parent}))};\n\n  return headersNewTicket;\n}\n\nfunction createAttachmentHeader(emailText) {\n  const textBody = ($) => `${$.val}`;\n\n  const makeAttachment = {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/octet-stream\", Authorization: paToken },\n    body: textBody({val: emailText})\n  };\n\n  return makeAttachment;\n}\n\nfunction addAttachmentHeader(attachURL) {\n  const newBody = ($) => [{\"op\": \"add\", \"path\": \"/relations/-\", \"value\": { \"rel\": \"AttachedFile\", \"url\": `${$.val}`, \"attributes\": {\"comment\": \"Created with Outlook Azure add-in\"}}}];\n\n  const headerAddAttachment = {\n    method: \"PATCH\",\n    headers: { \"Content-Type\": \"application/json-patch+json\", Authorization: paToken },\n    body: JSON.stringify(newBody({val: attachURL}))\n  };\n\n  return headerAddAttachment;\n}\n\nasync function getMaintenanceItems() {\n  let responseWIQL = await fetch(wiqlURL, headersWIQL);\n  let dataWIQL = await responseWIQL.json();\n  let ids = concatIDs(dataWIQL);\n  \n  let responseMaintenance = await fetch(idURL({val: ids}), headersMaintenance);\n  let dataMaintenance = await responseMaintenance.json();\n  createDropdown(dataMaintenance.value);\n}\n\nasync function createNewTicket() {\n  let [ticketType, parent, ticketTitle] = grabFormItems();\n  \n  let responseTicket = await fetch(ticketURL({val: ticketType}), createTicketHeader(parent, ticketTitle));\n  let dataTicket = await responseTicket.json();\n\n  let responseNewAttachment = await fetch(createAttachmentURL, createAttachmentHeader(textAttachment));\n  let dataAttachment = await responseNewAttachment.json();\n  \n  let responseAddAttachment = await fetch(updateAttachmentURL({val: dataTicket.id}), addAttachmentHeader(dataAttachment.url));\n  let dataAddAttachment = await responseAddAttachment.json();\n\n  document.getElementById(\"app-body\").innerHTML = `<div>DevOps ticket ${dataTicket.id} has been created. View the ticket in DevOps <a href=\"https://dev.azure.com/southbendin/Applications%20-%20Project%20Portfolio/_workitems/edit/${dataTicket.id}\">here</a></div>`;\n}\n\n// function getIteration() {\n//   let request2 = new XMLHttpRequest();\n//   let newURL = `https://dev.azure.com/southbendin/Applications%20-%20Project%20Portfolio/_apis/work/teamsettings/iterations?$timeframe=current&api-version=6.0`;\n//   request2.open(\"GET\", newURL);\n//   request2.setRequestHeader(\"Content-Type\", \"application/json\");\n//   request2.setRequestHeader(\n//     \"Authorization\",\n//     \"Basic \" + btoa(\"Basic\" + \":\" + \"iinmtwdby2a5k3v6dekdc5y53raw7vsavivuss4fm47l4bu6fwzq\")\n//   );\n//   request2.send();\n//   request2.onload = () => {\n//     res2 = JSON.parse(request2.response);\n//     let currentPath = res2.value[0].path;\n//     createTicket(currentPath);\n//   };\n// }\n\n// Office generated code when add-in is sideloaded\nOffice.onReady((info) => {\n  if (info.host === Office.HostType.Outlook) {\n    document.getElementById(\"sideload-msg\").style.display = \"none\";\n    document.getElementById(\"app-body\").style.display = \"flex\";\n    document.getElementById(\"run\").onclick = run;\n    \n    getMaintenanceItems();\n    var item = Office.context.mailbox.item;\n    \n    // Write message property value to the task pane\n    document.getElementById(\"item-subject\").placeholder = item.subject;\n    Office.context.mailbox.getCallbackTokenAsync({ isRest: true }, (result) => {\n      var ewsId = Office.context.mailbox.item.itemId;\n      var token = result.value;\n  \n      // var restId = Office.context.mailbox.convertToRestId(ewsId, Office.MailboxEnums.RestVersion.v2_0); this does not work on API version 1.1\n      var restId = ewsId.replaceAll(\"/\", \"-\").replaceAll(\"+\", \"_\"); // Convert ewsId to restId\n      var getMessageUrl = (Office.context.mailbox.restUrl || 'https://outlook.office365.com/api') + '/v2.0/me/messages/' + restId;\n      var xhr = new XMLHttpRequest();\n      xhr.open('GET', getMessageUrl);\n      xhr.setRequestHeader('Prefer', 'outlook.body-content-type=\"text\"') \n      xhr.setRequestHeader(\"Authorization\", \"Bearer \" + token);\n      xhr.onload = (e) => {\n        var json = JSON.parse(xhr.responseText);\n        textAttachment = json.Body.Content;\n      }\n      xhr.send();\n    });\n    // Office.context.mailbox.item.from.getAsync(function(asyncResult) {\n    //   if (asyncResult.status === Office.AsyncResultStatus.Succeeded) {\n    //     textAttachment += asyncResult.value + \"\\n\\n\";\n    //     console.log(\"Message from: \" + msgFrom.displayName + \" (\" + msgFrom.emailAddress + \")\");\n    //   } else {\n    //     console.error(asyncResult.error);\n    //   }\n    // });\n    // Office.context.mailbox.item.body.getAsync(\n    //   \"text\",\n    //   { asyncContext: \"This is passed to the callback\" },\n    //   function callback(result) {\n    //     textAttachment += result.value;\n    //     // document.getElementById(\"item-body\").innerHTML = \"<b>New Ticket Description:</b> <br/>\" + result.value;\n    //     // Do something with the result.\n    //   }\n    // );\n     //API call to get Maintenance Items\n  }\n});\n\nexport async function run() {\n  createNewTicket();\n} // end run()\n"],"names":["__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","d","definition","key","o","Object","defineProperty","enumerable","get","g","globalThis","this","Function","e","window","obj","prop","prototype","hasOwnProperty","call","scriptUrl","importScripts","location","document","currentScript","src","scripts","getElementsByTagName","length","Error","replace","p","textAttachment","idURL","$","val","wiqlURL","ticketURL","updateAttachmentURL","createAttachmentURL","paToken","btoa","headersWIQL","method","headers","Authorization","body","headersMaintenance","concatIDs","data","str","workItems","forEach","element","id","slice","createDropdown","maintenanceItems","Map","html","set","fields","sort","a","b","String","localeCompare","v","k","htmlSegment","querySelector","innerHTML","grabFormItems","selectResult","getElementById","value","checked","createTicketHeader","parent","ticketTitle","$1","$2","JSON","stringify","createAttachmentHeader","emailText","addAttachmentHeader","attachURL","fetch","responseWIQL","json","dataWIQL","ids","responseMaintenance","createNewTicket","ticketType","responseTicket","dataTicket","responseNewAttachment","dataAttachment","url","responseAddAttachment","run","Office","onReady","info","host","HostType","Outlook","style","display","onclick","getMaintenanceItems","item","context","mailbox","placeholder","subject","getCallbackTokenAsync","isRest","result","ewsId","itemId","token","restId","replaceAll","getMessageUrl","restUrl","xhr","XMLHttpRequest","open","setRequestHeader","onload","parse","responseText","Body","Content","send"],"sourceRoot":""}