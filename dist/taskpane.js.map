{"version":3,"file":"taskpane.js","mappings":"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","sources":["webpack:///webpack/bootstrap?","webpack:///webpack/runtime/global?","webpack:///webpack/runtime/publicPath?","webpack:///./src/taskpane/taskpane.js?","webpack:///./src/taskpane/components/functions.js?"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && !scriptUrl) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","/* eslint-disable prettier/prettier */\r\n/* eslint-disable no-undef */\r\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n * See LICENSE in the project root for license information.\r\n */\r\n\r\n// images references in the manifest\r\nimport \"../../assets/icon-16.png\";\r\nimport \"../../assets/icon-32.png\";\r\nimport \"../../assets/icon-80.png\";\r\nimport { idURL, ticketURL } from \"./components/functions.js\";\r\n\r\nlet textAttachment = \"\";\r\nlet attachments = [];\r\nlet selectedAttachments = [];\r\nlet attachmentArray = [];\r\nlet token = \"\";\r\n\r\n\r\n// declaring variables (or functions that return urls) for url addresses to use in various api calls\r\n// const idURL = ($) => `https://dev.azure.com/southbendin/_apis/wit/workitems?ids=${$.val}&api-version=6.0`;\r\nconst wiqlURL = 'https://dev.azure.com/southbendin/_apis/wit/wiql?api-version=6.0';\r\n// const ticketURL = ($) =>\r\n//   `https://dev.azure.com/southbendin/Digital%20-%20Product%20Portfolio/_apis/wit/workitems/$${$.val}?bypassrules=true&api-version=6.0`;\r\nconst updateAttachmentURL = ($) => `https://dev.azure.com/southbendin/_apis/wit/workitems/${$.val}?api-version=6.0`;\r\nconst createAttachmentURL = `https://dev.azure.com/southbendin/Digital%20-%20Product%20Portfolio/_apis/wit/attachments?fileName=OriginalEmail.html&api-version=6.0`;\r\nconst createAttachmentURL2 = ($) => `https://dev.azure.com/southbendin/Digital%20-%20Product%20Portfolio/_apis/wit/attachments?fileName=${$.val}&api-version=5.1`;\r\n\r\n// the token is assigned to appsadmin@southbendin.gov - we may want to rethink this in future releases with using the Microsoft Graph API\r\n// this token has an expiration date of 1/23/23\r\nconst paToken = \"Basic \" + btoa(\"Basic\" + \":\" + \"fcajyldotexdyluqenqd6lrqdimrr6shgrbdthg6tbmv4jpyikka\");\r\n\r\nconst queryWIQL = `{\r\n  \"query\": \"Select [System.Id], [System.Title], [System.State] From WorkItems Where [System.WorkItemType] = 'Maintenance' AND [System.State] <> 'Archived'\"}`;\r\n\r\nconst headersWIQL = {\r\n  method: \"POST\",\r\n  headers: { \"Content-Type\": \"application/json;charset=utf-8\", Authorization: paToken },\r\n  body: queryWIQL\r\n};\r\n\r\nconst headersMaintenance = {\r\n  method: \"GET\",\r\n  headers: { \"Content-Type\": \"application/json\", Authorization: paToken }};\r\n\r\nfunction concatIDs(data) {\r\n  let str = \"\";\r\n  data.workItems.forEach((element) => { str += element.id + \",\"  });\r\n  return str.slice(0, -1);\r\n}\r\n\r\nfunction createDropdown(data) {\r\n  const maintenanceItems = new Map();\r\n  let html = `<select id=\"parentItem\" name=\"parentItem\">`;\r\n  for (let d = 0; d < data.length; d++) {\r\n    maintenanceItems.set(data[d].id, data[d].fields[\"System.Title\"]);\r\n  }\r\n  const sortedItems = new Map([...maintenanceItems].sort((a, b) => String(a[1]).localeCompare(b[1])));\r\n  sortedItems.forEach(function (v, k) {\r\n    let htmlSegment = `<option value=\"${k}\">${v} - Maintenance Item: ${k}</option>`;\r\n    html += htmlSegment;\r\n  }); \r\n  html += `</select>`;\r\n  let container = document.querySelector(\"#dropdown\");\r\n  container.innerHTML = html;\r\n}\r\n\r\nfunction grabFormItems() {\r\n  let selectResult = document.getElementById(\"parentItem\").value;\r\n  //Get bug or task ticket\r\n  let ticketType = document.getElementById(\"bug-ticket\").checked ? \"Bug\" : \"Task\";\r\n  //get title for ticket\r\n  let ticketTitle = document.getElementById(\"item-subject\");\r\n  let ticketTitleValue = \"\";\r\n  if ( ticketTitle.value == \"\") {\r\n    ticketTitleValue = ticketTitle.placeholder;\r\n  } else {\r\n    ticketTitleValue = ticketTitle.value;\r\n  }\r\n  let ticketAssign = document.getElementById(\"users\").value;\r\n  return [ticketType, selectResult, ticketTitleValue, ticketAssign];\r\n}\r\n\r\nfunction createTicketHeader(parent, ticketTitle, creator, dev) {\r\n  fetch('https://dev.azure.com/southbendin/Digital%20-%20Product%20Portfolio/_apis/work/teamsettings/iterations?$timeframe=current&api-version=6.0')\r\n    .then( res => console.log(res));\r\n  const newBody = ($1, $2) => [\r\n    {\"op\": \"add\", \"path\": \"/fields/System.Title\", \"from\": null, \"value\": `${$1.val}` },\r\n    {\r\n      \"op\": \"add\",\r\n      \"path\": \"/fields/System.CreatedBy\",\r\n      \"value\": {\r\n        \"displayName\": `${creator.displayName}`,\r\n        \"url\": `${creator.url}`,\r\n        \"_links\": {\r\n          \"avatar\": {\r\n            \"href\": `${creator._links.avatar.href}`\r\n          }\r\n      },\r\n        \"id\": `${creator.originId}`,\r\n        \"uniqueName\": `${creator.uniqueName}`,\r\n        \"imageUrl\": `${creator.imageUrl}`,\r\n        \"descriptor\": `${creator.descriptor}`\r\n        }\r\n    },{\r\n      \"op\": \"add\",\r\n      \"path\": \"/fields/System.ChangedBy\",\r\n      \"value\": {\r\n          \"displayName\": `${creator.displayName}`,\r\n          \"url\": `${creator.url}`,\r\n          \"_links\": {\r\n            \"avatar\": {\r\n              \"href\": `${creator._links.avatar.href}`\r\n            }\r\n        },\r\n          \"id\": `${creator.originId}`,\r\n          \"uniqueName\": `${creator.uniqueName}`,\r\n          \"imageUrl\": `${creator.imageUrl}`,\r\n          \"descriptor\": `${creator.descriptor}`\r\n      }\r\n      },\r\n    {\r\n      \"op\": \"add\",\r\n      \"path\": \"/fields/System.AssignedTo\",\r\n      \"value\": `${dev}`\r\n    },\r\n    {\"op\": \"add\", \"path\": \"/relations/-\", \"value\": { \"rel\": \"System.LinkTypes.Hierarchy-Reverse\", \"url\": `https://dev.azure.com/southbendin/_apis/wit/workItems/${$2.val}`, \"attributes\": { \"isLocked\": false, \"name\": \"Parent\" }}}];\r\n    \r\n  const headersNewTicket = {method: 'POST', headers: { 'Content-Type': 'application/json-patch+json','Authorization': paToken}, body: JSON.stringify(newBody({val: ticketTitle}, {val: parent}))};\r\n  return headersNewTicket;\r\n}\r\n\r\nfunction createAttachmentHeader(emailText) {\r\n  const textBody = ($) => `${$.val}`;\r\n  const makeAttachment = {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/octet-stream\", Authorization: paToken },\r\n    body: textBody({val: emailText})\r\n  };\r\n  return makeAttachment;\r\n}\r\n\r\nfunction addAttachmentHeader(attachURL, textAttachment) {\r\n  const newBody = ($) => [\r\n    { \"op\": \"add\", \r\n      \"path\": \"/relations/-\", \r\n      \"value\": { \r\n        \"rel\": \"AttachedFile\", \"url\": `${$.val}`,\r\n        \"attributes\": {\r\n          \"comment\": \"Created with Outlook Azure add-in\"\r\n        }\r\n      }\r\n    },\r\n    {\r\n      \"op\": \"replace\",\r\n      \"path\": \"/fields/System.Description\",\r\n      \"value\": `${textAttachment}`\r\n    }\r\n  ];\r\n\r\n  const headerAddAttachment = {\r\n    method: \"PATCH\",\r\n    headers: { \"Content-Type\": \"application/json-patch+json\", Authorization: paToken },\r\n    body: JSON.stringify(newBody({val: attachURL}))\r\n  };\r\n    return headerAddAttachment;\r\n  } \r\n\r\n  function addIterationPath(path) {\r\n    const newBody = ($) => [\r\n        {\r\n          \"op\": \"add\",\r\n          \"path\": \"/fields/System.IterationPath\",\r\n          \"from\": null,\r\n          \"value\": `${$.val}`\r\n        }\r\n      ];\r\n  \r\n    const headerAddAttachment = {\r\n      method: \"PATCH\",\r\n      headers: { \"Content-Type\": \"application/json-patch+json\", Authorization: paToken },\r\n      body: JSON.stringify(newBody({val: path}))\r\n    };\r\n      return headerAddAttachment;\r\n    } \r\n\r\n\r\n\r\nasync function getMaintenanceItems() {\r\n  let responseWIQL = await fetch(wiqlURL, headersWIQL);\r\n  let dataWIQL = await responseWIQL.json();\r\n  let ids = concatIDs(dataWIQL);\r\n  let responseMaintenance = await fetch(idURL({val: ids}), headersMaintenance);\r\n  let dataMaintenance = await responseMaintenance.json();\r\n  createDropdown(dataMaintenance.value);\r\n}\r\n\r\nasync function handleAttachments(attachment, ticketInfo) {\r\n  // this works in grabing the attachment and adding it to the ticket - there doesn't seem to be size limits either\r\n    await fetch(`data:${attachment.ContentType};base64, ${attachment.ContentBytes}`)\r\n      .then( res => res.blob())\r\n      .then( async (blob) => {\r\n        await fetch(createAttachmentURL2({val: attachment.Name}), {\r\n          method: \"POST\",\r\n          headers: { \"Content-Type\": \"application/octet-stream\", Authorization: paToken },\r\n          body: blob\r\n        }).then( res =>  res.json())\r\n          .then ( async (data) => {\r\n            let temp = textAttachment.replace(`src=\"cid:${attachment.ContentId}\"`, `src=\"${data.url}\"`);\r\n            textAttachment = temp;\r\n            await fetch(updateAttachmentURL({val: ticketInfo.id}), addAttachmentHeader(data.url, textAttachment))\r\n            .then( res => res.json())\r\n          });\r\n      })\r\n} // end handleAttachments function\r\n\r\nfunction createNewTicket() {\r\n  let [ticketType, parent, ticketTitle, assignedDev] = grabFormItems();\r\n  let getCreator = fetch(\"https://vssps.dev.azure.com/southbendin/_apis/graph/users?api-version=6.0-preview.1\", {\r\n    method: \"GET\",\r\n    headers: {Authorization: paToken}\r\n    }).then( res => res.json() )\r\n      .then( (data) => {\r\n        for (let i = 0; i < data.value.length; i++) {\r\n          if (data.value[i].displayName == document.getElementById(\"ticketCreator\").value) {\r\n            return data.value[i];\r\n          }\r\n        }\r\n    });\r\n\r\n  let createTicketMethod = () => {\r\n    getCreator.then( (creator) => {\r\n      console.log(textAttachment);\r\n      fetch(ticketURL({val: ticketType}), createTicketHeader(parent, ticketTitle, creator, assignedDev))\r\n        .then( res => res.json())\r\n        .then( async (dataTicket) => {\r\n\r\n          // adding the email body as a html file (includes inline images)\r\n          let resAttach = await fetch(createAttachmentURL, createAttachmentHeader(textAttachment));\r\n          let dataAttach = await resAttach.json()\r\n          let addAttach = await fetch(updateAttachmentURL({val: dataTicket.id}), addAttachmentHeader(dataAttach.url, textAttachment));\r\n  \r\n          let currentIteration = await fetch(\"https://dev.azure.com/southbendin/Digital%20-%20Product%20Portfolio/_apis/work/teamsettings/iterations?$timeframe=current&api-version=6.0\", {\r\n            method: \"GET\",\r\n            headers: { \"Content-Type\": \"application/json\", Authorization: paToken }\r\n          });\r\n          let dataIteration = await currentIteration.json()\r\n          console.log(dataIteration)\r\n          let currentPath = await fetch(updateAttachmentURL({val: dataTicket.id}), addIterationPath(dataIteration.value[0].path));\r\n          let response = currentPath.json()\r\n          console.log(response)\r\n\r\n          // adding attachments selected by user\r\n          const tempSelected = document.querySelectorAll('input[type=\"checkbox\"]:checked');\r\n          for (let g = 0; g < tempSelected.length; g++ ) {\r\n            for ( let h = 0; h < attachmentArray.length; h++ ) {\r\n              if ( tempSelected[g].value == attachmentArray[h].Name) {\r\n                selectedAttachments.push(attachmentArray[h]);\r\n              }\r\n            }\r\n          }\r\n          \r\n          for ( let i = 0; i < selectedAttachments.length; i++ ) {\r\n            await handleAttachments(selectedAttachments[i], dataTicket);\r\n          }\r\n\r\n\r\n          // When sideloaded app has completed this message is printed to the user's sideload window\r\n          document.getElementById(\"app-body\").innerHTML = `<div>DevOps ticket ${dataTicket.id} has been created. View the ticket in DevOps <a href=\"https://dev.azure.com/southbendin/Digital%20-%20Product%20Portfolio/_workitems/edit/${dataTicket.id}\" target=\"_blank\">here</a></div>`;\r\n        })\r\n      });\r\n  }\r\n  createTicketMethod();\r\n} // end createNewTicket()\r\n\r\n// Office generated code when add-in is sideloaded\r\nOffice.onReady((info) => {\r\n  if (info.host === Office.HostType.Outlook) {\r\n    document.getElementById(\"sideload-msg\").style.display = \"none\";\r\n    document.getElementById(\"app-body\").style.display = \"flex\";\r\n    let btn = document.getElementById(\"run\");\r\n    btn.addEventListener(\"click\", () => {\r\n      run();\r\n      btn.setAttribute(\"disabled\", \"\");\r\n      btn.innerHTML = '<i class=\"fa fa-spinner fa-spin\"></i> Loading';\r\n    })\r\n    \r\n    getMaintenanceItems();\r\n    var item = Office.context.mailbox.item;\r\n    console.log(item);\r\n    textAttachment += `<p>Begin display of original email</p>\r\n                      <hr>\r\n                      <p>From: ${item.from.displayName} <br>\r\n                      Email: ${item.from.emailAddress} <br>`\r\n    var ticketCreator = Office.context.mailbox.userProfile.displayName;\r\n\r\n    // grab the info about attachments from the email \r\n    attachments = Office.context.mailbox.item.attachments;\r\n\r\n    // add the attachments to the add-in \r\n    let attachP = document.getElementById(\"files\");\r\n    let filesToInclude = \"\";\r\n    let conditions = ['.png', '.jpg', '.gif', '.jpeg', '.bmp', '.eps', '.jpeg']\r\n    for (let i = 0; i < attachments.length; i++) {\r\n      let test = conditions.some( c => attachments[i].name.includes(c));\r\n      if (!test) {\r\n        filesToInclude += `<input type=\"checkbox\" name=\"attachedFile\" checked value=\"${attachments[i].name}\">${attachments[i].name}<br>`;\r\n      } else {\r\n        filesToInclude += `<input type=\"checkbox\" name=\"attachedFile\" checked value=\"${attachments[i].name}\" style=\"visibility:hidden;\"><br>`;\r\n      }\r\n    }\r\n    filesToInclude += '<hr><p class=\"small-tag\">Inline image files are included by default</p>'\r\n    attachP.innerHTML = filesToInclude;\r\n\r\n    var attachments = Office.context.mailbox.item.attachments;\r\n    console.log(attachments);\r\n    \r\n    // Write message property value to the task pane\r\n    document.getElementById(\"item-subject\").placeholder = item.subject;\r\n    document.getElementById(\"ticketCreator\").value = ticketCreator; //This is hidden on the html form\r\n    \r\n    // This callback is to grab the inner\r\n    Office.context.mailbox.getCallbackTokenAsync({ isRest: true }, (result) => {\r\n      var ewsId = Office.context.mailbox.item.itemId;\r\n      token = result.value;\r\n  \r\n      // var restId = Office.context.mailbox.convertToRestId(ewsId, Office.MailboxEnums.RestVersion.v2_0); this does not work on API version 1.1\r\n      let restId = ewsId.replaceAll(\"/\", \"-\").replaceAll(\"+\", \"_\"); // Convert ewsId to restId\r\n      var getMessageUrl = (Office.context.mailbox.restUrl || 'https://outlook.office365.com/api') + '/v2.0/me/messages/' + restId;\r\n      var getAttachmentsUrl = getMessageUrl + '/attachments';\r\n      var xhr = new XMLHttpRequest();\r\n      xhr.open('GET', getMessageUrl);\r\n      xhr.setRequestHeader('Prefer', 'outlook.body-content-type=\"html\"') \r\n      xhr.setRequestHeader(\"Authorization\", \"Bearer \" + token);\r\n      xhr.onload = (e) => {\r\n        var json = JSON.parse(xhr.responseText);\r\n        textAttachment += json.Body.Content;\r\n        var xhr2 = new XMLHttpRequest();\r\n        xhr2.open('GET', getAttachmentsUrl);\r\n        xhr2.setRequestHeader(\"Authorization\", \"Bearer \" + token);\r\n        xhr2.onload = (e) => {\r\n          let json2 = JSON.parse(xhr2.responseText);\r\n          attachmentArray = json2.value;\r\n        \r\n        }\r\n        xhr2.send();\r\n      }\r\n      xhr.send();\r\n    });\r\n  }\r\n});\r\n\r\nexport async function run() {\r\n  createNewTicket();\r\n} \r\n","function idURL($) {\r\n  return `https://dev.azure.com/southbendin/_apis/wit/workitems?ids=${$.val}&api-version=6.0`;\r\n}\r\n\r\nfunction ticketURL($) {\r\n  return `https://dev.azure.com/southbendin/Applications%20-%20Project%20Portfolio/_apis/wit/workitems/$${$.val}?bypassrules=true&api-version=6.0`;\r\n}\r\n\r\nexport { idURL, ticketURL };\r\n"],"names":["__webpack_require__","g","globalThis","this","Function","e","window","scriptUrl","importScripts","location","document","currentScript","src","scripts","getElementsByTagName","length","i","Error","replace","p","textAttachment","selectedAttachments","attachmentArray","token","updateAttachmentURL","$","val","createAttachmentURL","createAttachmentURL2","paToken","btoa","headersWIQL","method","headers","Authorization","body","headersMaintenance","concatIDs","data","str","workItems","forEach","element","id","slice","createDropdown","maintenanceItems","Map","html","d","set","fields","sort","a","b","String","localeCompare","v","k","htmlSegment","querySelector","innerHTML","createAttachmentHeader","emailText","addAttachmentHeader","attachURL","JSON","stringify","addIterationPath","path","fetch","responseWIQL","json","dataWIQL","ids","responseMaintenance","value","handleAttachments","attachment","ticketInfo","ContentType","ContentBytes","then","res","blob","Name","temp","ContentId","url","createNewTicket","selectResult","getElementById","ticketType","checked","ticketTitle","placeholder","grabFormItems","parent","assignedDev","displayName","creator","console","log","dev","$1","$2","_links","avatar","href","originId","uniqueName","imageUrl","descriptor","createTicketHeader","dataTicket","resAttach","dataAttach","currentIteration","dataIteration","currentPath","response","tempSelected","querySelectorAll","h","push","Office","onReady","info","host","HostType","Outlook","style","display","btn","addEventListener","run","setAttribute","getMaintenanceItems","item","context","mailbox","from","emailAddress","ticketCreator","userProfile","attachments","attachP","filesToInclude","conditions","test","some","c","name","includes","subject","getCallbackTokenAsync","isRest","result","ewsId","itemId","restId","replaceAll","getMessageUrl","restUrl","getAttachmentsUrl","xhr","XMLHttpRequest","open","setRequestHeader","onload","parse","responseText","Body","Content","xhr2","json2","send"],"sourceRoot":""}